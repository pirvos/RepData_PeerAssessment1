---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
The data to be proceesed is originally in file "activity.csv", which is assumed 
to be part of the current working directory. The data is read into a dataframe 
named "activity". For that, the following R code is used: 

```{r reading data, echo = TRUE}
activity <- read.csv("activity.csv")
```

The following are some initial exploratory operations to better understand the data. 

1. Dimensions of the data are: 
```{r dimensions of data}
dimsactivity <- dim(activity)
print(paste("Number of rows =", dimsactivity[1]))
print(paste("Number of columns =", dimsactivity[2]))
```
Determine the number of observations per day. 
```{r}
library(dplyr)
gactivityDate <- group_by(activity, date)
dataPerDay <- dplyr::summarise(gactivityDate, count = n())
nobs <- unique(dataPerDay$count)
if(length(nobs) == 1) {
      print(paste("There are ", nobs[1], " observations for each day in the data set."))
      n = 24*60/5
      if(nobs[1]==n)
            print("This is exactly the number of 5-minute intervals in 24 hours.")
      else 
            print(paste("The number of 5-minute intervals in 24 hours is", n, "."))
} else {
      print("Observations per day differ. Some of those numbers are:")
      print(nobs)
}
```
This number correspo
2. A new column is added with values 1..7, idendifying the day of the week 
that each registered date corresponds to. The name of the column is _wdayNumber_
and is of type _integer_.
```{r adding column for days}
library(lubridate)
activity$wdayNumber <- day(activity$date)

```
4. A new column is added to contain a timestamp for each observation. Its values
are formed from the value of _date_ and the _interval_ columns. The name of the 
that new column _timeStamp_ and is of type _POSIXct_. The following 
R code is used. 
```{r adding timestamp to each observation} 
activity$timeStamp <- update(as_datetime(activity$date), hour = activity$interval/100, minute = activity$interval%%100)
```
The first rows of the processed table are: 
```{r}
head(activity)
```
## What is mean total number of steps taken per day?

```{r} 
library(dplyr)
gactivityDate <- group_by(activity, date)
sactivityDate <- dplyr::summarise(gactivityDate, totalSteps = sum(steps, na.rm = TRUE))
sactivityDate$n <- 1:nrow(sactivityDate)

barplot(sactivityDate$totalSteps, names.arg = sactivityDate$n, 
        xlab = "Day Recorded", ylab = "Total Number of Steps")
md <- round(median(sactivityDate$totalSteps), 2)
mn <- round(mean(sactivityDate$totalSteps), 2)
abline(h=md, col = "red")
abline(h=mn, col="blue")
title(main="Total Number of Steps Per Day Recorded")
legend("top", lty=1, lwd=2, legend=c(paste("median = ", md), 
                                     paste("mean = ", mn)), 
                                     col = c("red", "blue"))
```
... add beef describing what is shown...


## What is the average daily activity pattern?
To explore the average daily activity, we want to determine the average number 
of steps taken on each 5-minute interval. This can be done as follows. 
```{r}
library(dplyr)
gactivityInterval <- group_by(activity, interval)
sactivityInterval <- 
      dplyr::summarise(gactivityInterval, 
                       averageSteps = mean(steps, na.rm = TRUE))
sactivityInterval$intervalNumber <- 1:nrow(sactivityInterval)
plot(sactivityInterval$intervalNumber, sactivityInterval$averageSteps, type = "l",
     xlab = "5-minute Interval in a Day", ylab = "Average Number of Steps in Interval")
maxSteps <- max(sactivityInterval$averageSteps)
maxStepsPeriod <- subset(sactivityInterval, averageSteps == maxSteps)
print(paste("The 5-minute period with maximum average number of steps is: interval", 
            maxStepsPeriod$intervalNumber))
h <- maxStepsPeriod$interval
print(paste("It corresponds to the hour: ", 
            hm(paste(trunc(h/100), h%%100, sep = ":"))))

md <- round(median(sactivityInterval$averageSteps), 2)
mn <- round(mean(sactivityInterval$averageSteps), 2)
abline(h=md, col = "red")
abline(h=mn, col="blue")
title(main="Average Number of Steps Per 5-minute Interval Across All Days")
legend("topright", lty=1, lwd=2, legend=c(paste("median = ", md), 
                                     paste("mean = ", mn)), 
                                     col = c("red", "blue"))

```
... add beef describing what is shown...


## Imputing missing values



## Are there differences in activity patterns between weekdays and weekends?
Now let's add a new column to the activity data frame. This is a column of type 
factor and two levels: weekend and weekday. It classifies each of the 
observations in data frame activity depending to the day of the week that its
date corresponds to. 
```{r adding new factor attribute for days: dayType }
library(lubridate)
weekendDays <- activity$wdayNumber == 1 | activity$wdayNumber == 7
activity$dayType <- "weekday"
activity[weekendDays,]$dayType = "weekend"
activity$dayType <- as.factor(activity$dayType)
```
And verifying how many of the observations belongs to each of the two categories, 
we get the following: 
```{r count observations in each of the two categories} 
table(activity$dayType)
```

Now, let's plot to compare patterns in weekdays vs weekends. 

```{r} 
#library(lattice)
gactivityDaytypeInterval <- group_by(activity, dayType, interval)
sactivityDaytypeInterval <- dplyr::summarise(gactivityDaytypeInterval, average=mean(steps, na.rm = TRUE))
sactivityDaytypeInterval$intervalNumber <- rep(1:(nrow(sactivityDaytypeInterval)/2), 2)
rangey <- range(sactivityDaytypeInterval$average)
#with(sactivityDaytypeInterval, xyplot(average~intervalNumber|dayType, type = "l"), #layout=c(1,2))
with(subset(sactivityDaytypeInterval, dayType == "weekday"), plot(intervalNumber, average, type = "l", ylim = rangey))
mnwd <- round(mean(subset(sactivityDaytypeInterval, dayType=="weekday")$average),2)
mdwd <- round(median(subset(sactivityDaytypeInterval, dayType=="weekday")$average),2)
abline(h = mdwd, col="red")
abline(h = mnwd, col="blue")
legend("toplef", lty=1, lwd=2, legend=c(paste("median = ", mdwd), 
                                     paste("mean = ", mnwd)), 
                                     col = c("red", "blue"))
```

```{r}
with(subset(sactivityDaytypeInterval, dayType == "weekend"), plot(intervalNumber, average, type = "l", ylim = rangey))
mnwe <- round(mean(subset(sactivityDaytypeInterval, dayType=="weekend")$average), 2)
mdwe <- round(median(subset(sactivityDaytypeInterval, dayType=="weekend")$average), 2)
abline(h = mdwe, col="red")
abline(h = mnwe, col="blue")
legend("topleft", lty=1, lwd=2, legend=c(paste("median = ", mdwe), 
                                     paste("mean = ", mnwe)), 
                                     col = c("red", "blue"))
```

## The previous might not be correct... see readme from specifications...
## it should be something like the following: 
```{r} 
library(lattice)
gactivityDaytypeInterval <- group_by(activity, dayType, interval)
sactivityDaytypeInterval <- dplyr::summarise(gactivityDaytypeInterval, average=mean(steps, na.rm = TRUE))
sactivityDaytypeInterval$intervalNumber <- rep(1:(nrow(sactivityDaytypeInterval)/2), 2)
#rangey <- range(sactivityDaytypeInterval$average)
with(sactivityDaytypeInterval, xyplot(average~intervalNumber|dayType, type = "l"), layout=c(1,2))

```